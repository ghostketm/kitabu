{% extends 'base.html' %}

{% block content %}
<div class="max-w-4xl mx-auto my-8 bg-[#fdfaf0] p-8 md:p-12 rounded-lg shadow-2xl border-t-4 border-book-brown">
    <div class="flex justify-between items-start mb-6 border-b-2 border-dashed border-gray-300 pb-6">
        <div>
            <h1 class="text-4xl md:text-5xl font-bold text-book-brown" style="font-family: 'Georgia', serif;">{{ note.title }}</h1>
            <div class="flex items-center space-x-4 mt-4">
                {% if note.is_pinned %}
                    <span class="text-yellow-600 font-semibold flex items-center"><span class="text-xl mr-1">üìå</span> Pinned</span>
                {% endif %}
                {% if note.media_file %}
                    <span class="text-blue-600 font-semibold flex items-center"><span class="text-xl mr-1">üìé</span> Media Attached</span>
                {% endif %}
            </div>
        </div>
        <div class="flex flex-col md:flex-row items-end md:items-center gap-2 flex-shrink-0 ml-4">
            {% if note.author == user %}
                <a href="{% url 'notes:note_edit' note.pk %}" class="text-sm bg-blue-100 text-blue-800 font-bold py-2 px-4 rounded-lg hover:bg-blue-200 transition duration-300">Edit</a>
                {% if user.is_premium %}
                    <a href="{% url 'notes:note_share' note.pk %}" class="text-sm bg-green-100 text-green-800 font-bold py-2 px-4 rounded-lg hover:bg-green-200 transition duration-300">Share</a>
                {% endif %}
                <a href="{% url 'notes:note_delete' note.pk %}" class="text-sm bg-red-100 text-red-800 font-bold py-2 px-4 rounded-lg hover:bg-red-200 transition duration-300">Delete</a>
            {% endif %}
        </div>
    </div>
    
    <div class="prose prose-lg max-w-none text-gray-800 mt-6" style="font-family: 'Georgia', serif; white-space: pre-wrap;">
        {{ note.content|linebreaks }}
    </div>
    
    {% if note.media_file %}
        <div class="mt-8 pt-6 border-t border-gray-200">
            <h5 class="text-xl font-bold text-book-brown mb-4" style="font-family: 'Georgia', serif;">Attachment</h5>
            <div class="p-4 border border-gray-300 rounded-lg bg-white">
                <a href="{{ note.media_file.url }}" target="_blank" class="flex items-center text-blue-600 hover:underline font-semibold">
                    <span class="text-2xl mr-2">üìé</span>
                    <span>{{ note.media_filename }}</span>
                </a>
                {% if note.media_file.url|slice:"-4:"|lower == ".jpg" or note.media_file.url|slice:"-4:"|lower == ".png" or note.media_file.url|slice:"-5:"|lower == ".jpeg" or note.media_file.url|slice:"-4:"|lower == ".gif" %}
                    <img src="{{ note.media_file.url }}" class="max-w-md w-full h-auto rounded-lg mt-4 shadow-md" alt="Note attachment">
                {% endif %}
            </div>
        </div>
    {% endif %}
    
    {% if note.shared_with.all %}
        <div class="mt-8 pt-6 border-t border-gray-200">
            <h5 class="text-xl font-bold text-book-brown mb-2" style="font-family: 'Georgia', serif;">Shared with</h5>
            <div class="flex flex-wrap gap-2">
                {% if note.author == user %}
                    {% for shared_user in note.shared_with.all %}
                        <span class="bg-gray-200 text-gray-800 px-3 py-1 rounded-full text-sm font-medium">{{ shared_user.username }}</span>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    {% endif %}
    
    <div class="mt-8 pt-6 border-t border-gray-200 text-sm text-gray-500 text-right">
        <p>Author: {{ note.author.username }}</p>
        <p>Last updated: {{ note.updated_at|date:"F d, Y" }}</p>
    </div>
    
    <div class="mt-12 text-center">
        <a href="{% url 'notes:note_list' %}" class="bg-book-brown text-white font-bold py-3 px-6 rounded-lg hover:bg-opacity-90 transition duration-300 inline-block shadow-lg">‚Üê Back to All Notes</a>
    </div>
</div>
{% endblock %}